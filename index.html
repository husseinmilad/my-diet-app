<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دستیار هوشمند رژیم - نسخه ابری</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="دستیار لاغری">

<link rel="apple-touch-icon" href="icon-180.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <<script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Vazirmatn', 'sans-serif'] },
                    colors: {
                        primary: '#10b981',
                        secondary: '#34d399',
                        dark: '#064e3b',
                        accent: '#8b5cf6',
                    }
                }
            }
        }
    </script>
		
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #8b5cf6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #notification { transform: translateY(150%); transition: transform 0.3s ease-in-out; }
        #notification.show { transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col relative">

    <div id="notification" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-gray-800 text-white p-4 rounded-xl shadow-2xl z-[100] flex items-center justify-between">
        <span id="notifMessage" class="text-sm">پیام سیستم</span>
        <button onclick="hideNotification()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
    </div>

    <header class="bg-primary text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-cloud-upload-alt text-white/80"></i>
                دستیار ابری لاغری
            </h1>
            <div class="flex gap-2">
                <button onclick="askCoach()" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm transition flex items-center gap-1 border border-white/30 backdrop-blur-sm">
                    <i class="fas fa-robot"></i>
                    <span class="hidden sm:inline">مربی هوشمند</span>
                </button>
                <button onclick="toggleSettings()" class="text-white hover:text-gray-200 transition px-2">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 flex-grow max-w-lg relative">
        <div id="loadingOverlay" class="flex flex-col items-center justify-center py-20">
            <div class="loader w-12 h-12"></div>
            <p class="mt-4 text-gray-500">در حال همگام‌سازی با ابر...</p>
        </div>
<div id="loginView" class="hidden bg-white rounded-2xl p-6 card-shadow text-center mb-6">
    <i class="fas fa-user-shield text-4xl text-primary mb-3"></i>
    <h2 class="text-xl font-bold mb-4">ورود به حساب ابری</h2>
    <p class="text-sm text-gray-500 mb-4">یک نام کاربری انتخاب کنید تا اطلاعات شما روی گوشی و کامپیوتر همگام بماند.</p>
    <input type="text" id="usernameInput" placeholder="نام کاربری (مثلاً: ali1402)" class="w-full p-3 border rounded-xl text-center mb-4 focus:ring-2 focus:ring-primary outline-none">
    <button onclick="loginUser()" class="w-full bg-primary text-white py-3 rounded-xl font-bold hover:bg-dark transition">تایید و ورود</button>
</div>
        <div id="setupView" class="hidden">
            <div class="bg-white rounded-2xl p-6 card-shadow text-center">
                <h2 class="text-2xl font-bold mb-4 text-primary">خوش آمدید!</h2>
                <form onsubmit="saveProfile(event)" class="space-y-4 text-right">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">جنسیت</label>
                            <select id="gender" class="w-full p-2 border rounded-lg bg-gray-50">
                                <option value="male">مرد</option>
                                <option value="female">زن</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">سن</label>
                            <input type="number" id="age" required class="w-full p-2 border rounded-lg bg-gray-50 text-center">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">وزن (kg)</label>
                            <input type="number" id="weight" step="0.1" required class="w-full p-2 border rounded-lg bg-gray-50 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">قد (cm)</label>
                            <input type="number" id="height" required class="w-full p-2 border rounded-lg bg-gray-50 text-center">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">میزان فعالیت</label>
                        <select id="activity" class="w-full p-2 border rounded-lg bg-gray-50">
                            <option value="1.2">کم تحرک</option>
                            <option value="1.375">کم (۱-۳ روز)</option>
                            <option value="1.55">متوسط (۳-۵ روز)</option>
                            <option value="1.725">زیاد (۶-۷ روز)</option>
                            <option value="1.9">خیلی زیاد</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">هدف</label>
                        <select id="goal" class="w-full p-2 border rounded-lg bg-gray-50">
                            <option value="lose">کاهش وزن</option>
                            <option value="maintain">تثبیت وزن</option>
                            <option value="gain">افزایش وزن</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-xl font-bold hover:bg-dark transition shadow-md mt-4">ذخیره در ابر و شروع</button>
                </form>
            </div>
        </div>

        <div id="dashboardView" class="hidden space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-2xl card-shadow text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-2 h-full bg-blue-500"></div>
                    <p class="text-xs text-gray-500 mb-1 text-center">هدف روزانه</p>
                    <h3 id="dailyGoalDisplay" class="text-2xl font-bold text-gray-800">--</h3>
                </div>
                <div class="bg-white p-4 rounded-2xl card-shadow text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-2 h-full bg-primary"></div>
                    <p class="text-xs text-gray-500 mb-1 text-center">باقی‌مانده</p>
                    <h3 id="remainingDisplay" class="text-2xl font-bold text-primary">--</h3>
                </div>
            </div>

            <div class="bg-white p-4 rounded-2xl card-shadow">
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-600">مصرف شده: <strong id="consumedDisplay">0</strong></span>
                    <span id="percentDisplay" class="text-gray-500">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                    <div id="progressBar" class="bg-primary h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-2xl card-shadow relative">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center gap-2"><i class="fas fa-plus-circle text-primary"></i>افزودن وعده</h3>
                    <button onclick="toggleSmartAdd()" class="text-xs bg-accent text-white px-3 py-1.5 rounded-full hover:bg-violet-700 transition flex items-center gap-1 shadow-sm">
                        <i class="fas fa-magic"></i>محاسبه هوشمند
                    </button>
                </div>
                <form onsubmit="addFood(event)" class="flex gap-2">
                    <input type="text" id="foodName" placeholder="نام غذا" required class="flex-grow p-2 border rounded-lg bg-gray-50">
                    <input type="number" id="foodCalories" placeholder="کالری" required class="w-20 p-2 border rounded-lg bg-gray-50 text-center">
                    <button type="submit" class="bg-primary text-white px-4 rounded-lg hover:bg-dark transition"><i class="fas fa-check"></i></button>
                </form>
            </div>

            <div id="foodList" class="space-y-3 pb-10"></div>
        </div>

        <!-- Modals (Smart Add, Coach, Settings) similar to previous version -->
        <!-- Smart Add Modal -->
        <div id="smartAddModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl p-6 w-full max-w-sm relative">
                <button onclick="toggleSmartAdd()" class="absolute top-4 left-4 text-gray-400"><i class="fas fa-times"></i></button>
                <h3 class="text-xl font-bold mb-2 text-accent">محاسبه هوشمند</h3>
                <textarea id="smartInput" rows="3" class="w-full p-3 border rounded-xl bg-gray-50 mb-4" placeholder="مثلاً: دو سیخ جوجه کباب با برنج"></textarea>
                <button onclick="analyzeFood()" id="analyzeBtn" class="w-full bg-accent text-white py-3 rounded-xl font-bold">محاسبه کن</button>
            </div>
        </div>

        <!-- Coach Modal -->
        <div id="coachModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl p-6 w-full max-w-sm relative text-center">
                <button onclick="closeCoach()" class="absolute top-4 left-4 text-gray-400"><i class="fas fa-times"></i></button>
                <i class="fas fa-robot text-4xl text-blue-500 mb-2"></i>
                <h3 class="text-xl font-bold mb-4">مربی همراه</h3>
                <div id="coachContent" class="text-sm text-gray-700 mb-6 min-h-[60px]"></div>
                <button onclick="closeCoach()" class="w-full bg-gray-100 py-2 rounded-xl">بستن</button>
            </div>
        </div>

        <!-- Settings Modal -->
        <<div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">تنظیمات</h3>
        
        <div class="mb-4 p-4 bg-violet-50 rounded-xl">
            <label class="block text-xs font-bold text-violet-700 mb-2">کلید هوش مصنوعی (Gemini API)</label>
            <input type="password" id="apiKeyInput" placeholder="کلید API" class="w-full p-2 border rounded-lg text-sm mb-2">
            <button onclick="saveApiKey()" class="w-full bg-violet-500 text-white py-2 rounded-lg text-sm">ذخیره کلید</button>
        </div>

        <div class="flex flex-col gap-2">
            <button onclick="resetProfile()" class="w-full bg-orange-100 text-orange-600 py-2 rounded-xl text-sm font-bold">ویرایش مشخصات جسمی</button>
            <button onclick="logout()" class="w-full bg-red-100 text-red-600 py-2 rounded-xl text-sm font-bold">
                <i class="fas fa-sign-out-alt ml-1"></i> خروج از حساب کاربری
            </button>
            <button onclick="toggleSettings()" class="w-full bg-gray-100 py-2 rounded-xl text-sm mt-2">بستن</button>
        </div>
        <div class="mt-4 text-[10px] text-gray-400 text-center break-all" id="userIdDisplay"></div>
    </div>
</div>
    </main>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAsEjCu2yMjlTMbKr6scxtyBaGq5sLjEZg",
        authDomain: "diet-48e77.firebaseapp.com",
        projectId: "diet-48e77",
        storageBucket: "diet-48e77.firebasestorage.app",
        messagingSenderId: "1000587455568",
        appId: "1:1000587455568:web:a58eeeaa044b79d6dc7555"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    let currentUserId = localStorage.getItem('diet_user_id') || null;
    let userData = { profile: null, foods: [] };
    let unsubProfile = null;
    let unsubFoods = null;

    // تابع ورود: بعد از وارد کردن یوزر، چک میکند اطلاعات قبلی هست یا نه
    window.loginUser = () => {
        const username = document.getElementById('usernameInput').value.trim().toLowerCase();
        if (username.length < 3) {
            alert("نام کاربری باید حداقل ۳ حرف باشد");
            return;
        }
        currentUserId = username;
        localStorage.setItem('diet_user_id', username);
        document.getElementById('loginView').classList.add('hidden');
        document.getElementById('loadingOverlay').classList.remove('hidden'); // نمایش لودینگ تا زمان دریافت دیتا
        initSync();
    };

    // تابع خروج
    window.logout = () => {
        if(confirm("آیا قصد خروج از حساب را دارید؟")) {
            localStorage.removeItem('diet_user_id');
            location.reload(); // بازنشانی صفحه برای بازگشت به منوی ورود
        }
    };

    function initSync() {
        if (!currentUserId) {
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('loadingOverlay').classList.add('hidden');
            return;
        }

        document.getElementById('userIdDisplay').innerText = `شناسه کاربر: ${currentUserId}`;
        const profileRef = doc(db, 'users', currentUserId, 'settings', 'profile');
        const foodsRef = collection(db, 'users', currentUserId, 'foods');

        if (unsubProfile) unsubProfile();
        if (unsubFoods) unsubFoods();

        unsubProfile = onSnapshot(profileRef, (snapshot) => {
            const data = snapshot.data();
            // اگر اطلاعات پروفایل خالی بود (Object.keys چک میکند فیلدها وجود دارند یا نه)
            if (data && data.dailyLimit) {
                userData.profile = data;
            } else {
                userData.profile = null;
            }
            render();
            document.getElementById('loadingOverlay').classList.add('hidden');
        });

        unsubFoods = onSnapshot(foodsRef, (snapshot) => {
            userData.foods = snapshot.docs.map(d => ({ id: d.id, ...d.data() }))
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            render();
        });
    }

    // ذخیره پروفایل (بدون تغییر)
    window.saveProfile = async (e) => {
        e.preventDefault();
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const age = parseInt(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;
        const activity = parseFloat(document.getElementById('activity').value);
        const goalType = document.getElementById('goal').value;

        let bmr = (10 * weight) + (6.25 * height) - (5 * age);
        bmr = (gender === 'male') ? bmr + 5 : bmr - 161;
        let dailyLimit = Math.round(bmr * activity);
        if (goalType === 'lose') dailyLimit -= 500;
        if (goalType === 'gain') dailyLimit += 500;

        try {
            await setDoc(doc(db, 'users', currentUserId, 'settings', 'profile'), {
                weight, height, age, gender, activity, goalType, dailyLimit, updatedAt: new Date().toISOString()
            });
            showNotification("اطلاعات در حساب شما ذخیره شد", "success");
        } catch (e) { showNotification("خطا در ذخیره", "error"); }
    };

    // سایر توابع UI (رندر، آپدیت داشبورد و حذف غذا) مشابه قبل باقی می‌مانند
    function render() {
        const setupView = document.getElementById('setupView');
        const dashboardView = document.getElementById('dashboardView');
        const loginView = document.getElementById('loginView');

        if (!currentUserId) {
            loginView.classList.remove('hidden');
            setupView.classList.add('hidden');
            dashboardView.classList.add('hidden');
        } else if (!userData.profile) {
            loginView.classList.add('hidden');
            setupView.classList.remove('hidden'); // نمایش فرم سن/وزن فقط اگر دیتا در ابر نبود
            dashboardView.classList.add('hidden');
        } else {
            loginView.classList.add('hidden');
            setupView.classList.add('hidden');
            dashboardView.classList.remove('hidden');
            updateDashboard();
        }
    }

    function updateDashboard() {
        if (!userData.profile) return;
        const { dailyLimit } = userData.profile;
        const consumed = userData.foods.reduce((sum, f) => sum + f.calories, 0);
        const remaining = dailyLimit - consumed;
        document.getElementById('dailyGoalDisplay').innerText = dailyLimit.toLocaleString('fa-IR');
        document.getElementById('consumedDisplay').innerText = consumed.toLocaleString('fa-IR');
        document.getElementById('remainingDisplay').innerText = remaining.toLocaleString('fa-IR');
        const percent = Math.min((consumed / dailyLimit) * 100, 100);
        document.getElementById('progressBar').style.width = `${percent}%`;
        document.getElementById('percentDisplay').innerText = `${Math.round(percent)}%`;
        const list = document.getElementById('foodList');
        list.innerHTML = userData.foods.length ? '' : '<p class="text-center text-gray-400 py-10">لیستی یافت نشد</p>';
        userData.foods.forEach(food => {
            const item = document.createElement('div');
            item.className = 'bg-white p-3 rounded-xl flex justify-between items-center shadow-sm border-r-4 border-primary';
            item.innerHTML = `<div><p class="font-bold">${food.name}</p></div><div class="flex items-center gap-3"><span class="text-primary font-bold">${food.calories.toLocaleString('fa-IR')}</span><button onclick="deleteFood('${food.id}')" class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button></div>`;
            list.appendChild(item);
        });
    }

    window.addFood = async (e) => {
        e.preventDefault();
        const name = document.getElementById('foodName').value;
        const calories = parseInt(document.getElementById('foodCalories').value);
        if (name && calories) {
            await addDoc(collection(db, 'users', currentUserId, 'foods'), {
                name, calories, timestamp: new Date().toISOString()
            });
            document.getElementById('foodName').value = '';
            document.getElementById('foodCalories').value = '';
        }
    };

    window.deleteFood = async (id) => {
        await deleteDoc(doc(db, 'users', currentUserId, 'foods', id));
    };

    window.resetProfile = async () => {
         // این تابع فقط برای ویرایش است، اطلاعات را پاک نمی‌کند تا فرم دوباره باز شود
         document.getElementById('setupView').classList.remove('hidden');
         document.getElementById('dashboardView').classList.add('hidden');
         toggleSettings();
    };
// این را به انتهای تگ اسکریپت اول (type="module") اضافه کنید
window.saveApiKey = async () => {
    const val = document.getElementById('apiKeyInput').value.trim();
    if(!val) {
        showNotification("لطفاً کلید را وارد کنید", "error");
        return;
    }
    if(!currentUserId) {
        showNotification("ابتدا وارد حساب کاربری شوید", "error");
        return;
    }

    try {
        const profileRef = doc(db, 'users', currentUserId, 'settings', 'profile');
        await setDoc(profileRef, { apiKey: val }, { merge: true });
        showNotification("کلید در حساب ابری شما ذخیره شد", "success");
        document.getElementById('apiKeyInput').value = "";
    } catch (e) {
        console.error(e);
        showNotification("خطا در ذخیره ابری", "error");
    }
};
    // راه اندازی اولیه
    initSync();
	async function callGemini(prompt) {
    // خواندن کلید از پروفایل کاربر که از فایربیس لود شده است
    const apiKey = userData.profile ? userData.profile.apiKey : null;
    
    if (!apiKey) {
        showNotification("کلید API در حساب شما یافت نشد. در تنظیمات ذخیره کنید.", "error");
        toggleSettings();
        return null;
    }

    // آدرس دقیق و تست شده مدل
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }]
            })
        });

        // اگر خطای 404 یا هر خطای دیگری داد
        if (!response.ok) {
            const errorData = await response.json();
            console.error("Google API Error:", errorData);
            
            if (response.status === 404) {
                showNotification("خطای 404: مدل پیدا نشد یا آدرس اشتباه است", "error");
            } else if (response.status === 403) {
                showNotification("خطای 403: کلید API معتبر نیست یا دسترسی ندارید", "error");
            }
            return null;
        }

        const data = await response.json();
        return data.candidates[0].content.parts[0].text;

    } catch (error) {
        console.error("Network Error:", error);
        showNotification("خطای شبکه! احتمالا باید VPN را روشن کنید", "error");
        return null;
    }
}

// تابع محاسبه هوشمند کالری
async function analyzeFood() {
    const input = document.getElementById('smartInput').value;
    if (!input) return;
    
    const btn = document.getElementById('analyzeBtn');
    btn.disabled = true;
    btn.innerText = "در حال تحلیل...";

    const prompt = `تحلیل کالری غذا: "${input}". 
    فقط و فقط یک عدد تخمینی (بدون متن اضافه) برای مجموع کالری این غذا برگردان. 
    اگر چند آیتم است مجموع را بده. فقط عدد انگلیسی.`;

    const result = await callGemini(prompt);
    if (result) {
        const calories = result.replace(/[^0-9]/g, '');
        document.getElementById('foodName').value = input;
        document.getElementById('foodCalories').value = calories;
        toggleSmartAdd();
        showNotification("کالری محاسبه و جایگذاری شد", "success");
    }
    
    btn.disabled = false;
    btn.innerText = "محاسبه کن";
}

// تابع مربی هوشمند
async function askCoach() {
    document.getElementById('coachModal').classList.remove('hidden');
    const content = document.getElementById('coachContent');
    content.innerHTML = '<div class="loader mx-auto"></div>';

    const consumed = document.getElementById('consumedDisplay').innerText;
    const goal = document.getElementById('dailyGoalDisplay').innerText;
    
    const prompt = `من یک مربی تغذیه هستم. کاربر تا الان ${consumed} کالری مصرف کرده و هدف روزانه‌اش ${goal} است. 
    یک توصیه خیلی کوتاه، انگیزشی و کاربردی به زبان فارسی برای ادامه روز به او بده. حداکثر دو جمله.`;

    const advice = await callGemini(prompt);
    if (advice) {
        content.innerText = advice;
    } else {
        content.innerText = "خطا در دریافت پاسخ. لظفا تنظیمات API را چک کنید.";
    }
}

// متصل کردن توابع به پنجره برای دسترسی دکمه‌ها
window.analyzeFood = analyzeFood;
window.askCoach = askCoach;
</script>

    <script>
        // UI Helpers
        function showNotification(msg, type) {
            const n = document.getElementById('notification');
            document.getElementById('notifMessage').innerText = msg;
            n.classList.add('show');
            setTimeout(() => n.classList.remove('show'), 3000);
        }
        function hideNotification() { document.getElementById('notification').classList.remove('show'); }
        function toggleSettings() { document.getElementById('settingsModal').classList.toggle('hidden'); }
        function toggleSmartAdd() { document.getElementById('smartAddModal').classList.toggle('hidden'); }
        function closeCoach() { document.getElementById('coachModal').classList.add('hidden'); }

    </script>
</body>
</html>